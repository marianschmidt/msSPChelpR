<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the msSPChelpR package - from long dataset to SIR analyses • msSPChelpR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the msSPChelpR package - from long dataset to SIR analyses">
<meta property="og:description" content="msSPChelpR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">msSPChelpR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8.4.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction to the msSPChelpR package - from long dataset to SIR analyses</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/marianschmidt/msSPChelpR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to the msSPChelpR package - from long dataset to SIR analyses</h1>
                        <h4 class="author">Marian Eberl</h4>
            
            <h4 class="date">13 May 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/marianschmidt/msSPChelpR/blob/master/vignettes/introduction.Rmd"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">msSPChelpR</span>)</pre></body></html></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette explains how to use the functions:</p>
<ul>
<li>
<code>pat_status</code> to determine patient status at end of follow-up</li>
<li>
<code>vital_status</code> to determine vital status whether patient is alive or dead at end of follow-up</li>
<li>
<code>calc_futime</code> to calculate follow-up time from index event until next event, death or end of follow-up date</li>
</ul>
</div>
<div id="recommended-workflows" class="section level1">
<h1 class="hasAnchor">
<a href="#recommended-workflows" class="anchor"></a>Recommended Workflows</h1>
<div id="wf-calc-fu" class="section level2">
<h2 class="hasAnchor">
<a href="#wf-calc-fu" class="anchor"></a>Calculate follow-up times</h2>
<p>It is recommended to run the following steps in the correct order to obtain accurate follow-up time calculations</p>
<ol style="list-style-type: decimal">
<li>
<a href="#step-long">Use the long version dataset</a> to <a href="#step-filter">filter all cases</a> that are relevant for your analysis. Make sure that:</li>
</ol>
<ul>
<li>for each <code>case_id</code> the index event (e.g. First Cancer FC) is still included and is the one remaining row in the dataset with the smallest <code>case_id</code> (<code>TUMID3</code> variable for ZfKD data, and <code>SEQ_NUM</code> for SEER data)</li>
<li>all <code>case_id</code>s might or might not get a countable incident event (e.g. Second Primary Cancer SPC). This event should be the second entry per <code>case_id</code> (second smallest <code>case_id</code>) if it is to be counted</li>
<li>in the long version dataset a <code>count_var</code> should indicate whether the countable incident event (SPC) has occured or not. Coded <code>0</code> for non-occurence (or not counted event) and <code>1</code> for a counted incident event.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><p><a href="#step-renumber">Renumber filtered long dataset</a>: In the filter long dataset, you should run the helper function <code><a href="../reference/renumber_time_id_dt.html">msSPChelpR::renumber_time_id_dt()</a></code> (or non-data.table variant <code><a href="../reference/renumber_time_id.html">msSPChelpR::renumber_time_id()</a></code>) that will renumber all events per <code>case_id</code> and (if step 1 is fulfilled) will assign each index event with <code>time_var_new = 1</code> and each second (possibly countable incidenct event) with <code>time_var_new = 2</code>. Any SIR related function will only count the second event, if additionally to <code>time_var_new = 2</code> for this row also <code>count_var = 1</code> is true.</p></li>
<li><p><a href="#step-reshape-wide">Reshape dataset</a>: Run <code><a href="../reference/reshape_wide_dt.html">msSPChelpR::reshape_wide_dt()</a></code> or non-data.table-variant <code><a href="../reference/reshape_wide.html">msSPChelpR::reshape_wide()</a></code>, so that datset is transposed to wide format (1 row per <code>case_id</code>, creating variables such as <code>count_var.2</code>).</p></li>
<li><p><a href="#step-spc">Set flag for Second Primary Cancer diagnosis</a>: After filtering and reshaping it is essential to set <code>p_spc</code> again. This variable will be used by later steps of the analysis.</p></li>
<li><p><a href="#step-pat-status">Determine patient status</a> at a defined end of follow-up by using the <code><a href="../reference/pat_status.html">msSPChelpR::pat_status()</a></code> function. This date for end of follow-up must:</p></li>
</ol>
<ul>
<li>be in “YYYY-MM-DD” format and is always defined via the <code>fu_end =</code> parameter</li>
<li>must preceed the end of data collection. E.g. if the last incident events for the dataset you are using are collected at the end of 2014, your <code>fu_end</code> must be <code>fu_end = "2014-12-15"</code> or earlier.</li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li>
<a href="#step-calc-futime">Calculate follow-up time</a> for the same dataset by using the <code><a href="../reference/calc_futime.html">msSPChelpR::calc_futime()</a></code> function and the same <code>fu_end</code> as for step 4. By standard all functions of the <code>msSPChelpR</code> package require follow-up times as numeric years.</li>
</ol>
</div>
<div id="calculate-standardized-incidence-ratios-sir" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-standardized-incidence-ratios-sir" class="anchor"></a>Calculate Standardized Incidence Ratios (SIR)</h2>
<p>In order to calculate SIR using the package functions, the following data structure is needed: * Wide format data <code>wide_df</code> with one row per patient that has encountered the index event (i.e. diagnosed with a first primary cancer FC)</p>
<ul>
<li>The dataset <code>wide_df</code> needs to contain the following variables (columns) per patient (row):
<ul>
<li>
<code>region_var</code> - variable in df that contains information on region where case was incident.</li>
<li>
<code>agegroup_var</code> - variable in df that contains information on age-group.</li>
<li>
<code>sex_var</code> - variable in df that contains information on biological sex.</li>
<li>
<code>year_var</code> - variable in df that contains information on year or year-period when case was incident.</li>
<li>
<code>icdcat_var</code> - variable in df that contains information on case (count event) diagnosis. Cases are usually the second cancers. Diagnoses can use any coding system (e.g. ICD) but coding system between dataset and reference data must be coherent.</li>
<li>
<code>futime_var</code> - variable in df that contains follow-up time per person between date of first cancer and any of death, date of event (case), end of FU date (in years; whatever event comes first). In case you have not calculated the FU time yet, you can use the workflow described in the previous <a href="#wf-calc-fu">chapter</a>.</li>
</ul>
</li>
</ul>
<p>If your data has the required structure, you can calculate and summarize SIRs with the following two steps:</p>
<ol start="7" style="list-style-type: decimal">
<li>
<a href="#step-sir-byfutime">Calculate SIR</a> per SPC diagnosis with age, sex, region, period-specific strata using the <code><a href="../reference/sir_byfutime.html">msSPChelpR::sir_byfutime()</a></code> function. For this calculation usually a reference dataset is required that defines the population standard rates. <code>refpop_df</code> must use the same category coding of age, sex, region, year and icdcat as <code>agegroup_var</code>, <code>sex_var</code>, <code>region_var</code>, <code>year_var</code> and <code>icdcat_var</code>
</li>
</ol>
<ul>
<li>The theory behind calculating stratified SIRs is explained in the chapter on <a href="#theo-sir">basics on SIRs</a>
</li>
</ul>
<ol start="8" style="list-style-type: decimal">
<li>
<a href="#step-summarize-sir">Summarize SIR results</a> using the <code><a href="../reference/summarize_sir_results.html">msSPChelpR::summarize_sir_results()</a></code> function on the stratified sir results produced by the previous step.</li>
</ol>
</div>
</div>
<div id="details-on-single-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#details-on-single-functions" class="anchor"></a>Details on single functions</h1>
<div id="renumber_time_id-function" class="section level2">
<h2 class="hasAnchor">
<a href="#renumber_time_id-function" class="anchor"></a><code>renumber_time_id()</code> function</h2>
</div>
<div id="reshape_wide-function" class="section level2">
<h2 class="hasAnchor">
<a href="#reshape_wide-function" class="anchor"></a><code>reshape_wide()</code> function</h2>
</div>
<div id="reshape_long-function" class="section level2">
<h2 class="hasAnchor">
<a href="#reshape_long-function" class="anchor"></a><code>reshape_long()</code> function</h2>
</div>
<div id="pat_status-function" class="section level2">
<h2 class="hasAnchor">
<a href="#pat_status-function" class="anchor"></a><code>pat_status()</code> function</h2>
</div>
<div id="vital_status-function" class="section level2">
<h2 class="hasAnchor">
<a href="#vital_status-function" class="anchor"></a><code>vital_status()</code> function</h2>
</div>
<div id="calc_futime-function" class="section level2">
<h2 class="hasAnchor">
<a href="#calc_futime-function" class="anchor"></a><code>calc_futime()</code> function</h2>
</div>
<div id="sir_byfutime-function" class="section level2">
<h2 class="hasAnchor">
<a href="#sir_byfutime-function" class="anchor"></a><code>sir_byfutime()</code> function</h2>
</div>
<div id="summarize_sir_results-function" class="section level2">
<h2 class="hasAnchor">
<a href="#summarize_sir_results-function" class="anchor"></a><code>summarize_sir_results()</code> function</h2>
</div>
</div>
<div id="theo-sir" class="section level1">
<h1 class="hasAnchor">
<a href="#theo-sir" class="anchor"></a>Theory behind SIRs</h1>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h1>
<div id="seer-lung-cancer" class="section level2">
<h2 class="hasAnchor">
<a href="#seer-lung-cancer" class="anchor"></a>SEER lung cancer</h2>
<div id="step-long" class="section level3">
<h3 class="hasAnchor">
<a href="#step-long" class="anchor"></a>Step 1 - Long dataset</h3>
</div>
<div id="step-filter" class="section level3">
<h3 class="hasAnchor">
<a href="#step-filter" class="anchor"></a>Step 2 - Filter long dataset</h3>
</div>
<div id="step-renumber" class="section level3">
<h3 class="hasAnchor">
<a href="#step-renumber" class="anchor"></a>Step 3 - Renumber <code>time_id</code>
</h3>
</div>
<div id="step-reshape-wide" class="section level3">
<h3 class="hasAnchor">
<a href="#step-reshape-wide" class="anchor"></a>Step 4 - Reshape to wide dataset</h3>
</div>
<div id="step-spc" class="section level3">
<h3 class="hasAnchor">
<a href="#step-spc" class="anchor"></a>Step 5 - Recalculate <code>p_spc</code>
</h3>
<div class="sourceCode" id="cb2"><html><body><pre class="r">
<span class="no">wide_sdata_lung</span> <span class="kw">&lt;-</span> <span class="no">wide_sdata_lung</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">p_spc</span> <span class="kw">=</span> <span class="fu">case_when</span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">PRIMSITE.2</span>)     ~ <span class="fl">0</span>,
                         !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">PRIMSITE.2</span>)    ~ <span class="fl">1</span>,
                         <span class="fl">TRUE</span> ~ <span class="fl">NA_real_</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">sjlabelled</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sjlabelled/man/set_label.html">var_labels</a></span>(<span class="kw">p_spc</span><span class="kw">=</span><span class="st">"Patient has developed Second Primary Cancer"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">sjlabelled</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sjlabelled/man/set_labels.html">set_labels</a></span>(<span class="no">p_spc</span>, <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"no SPC"</span> <span class="kw">=</span> <span class="fl">0</span>,
                                           <span class="st">"SPC developed"</span> <span class="kw">=</span> <span class="fl">1</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">p_spc</span> <span class="kw">=</span>  <span class="kw pkg">sjlabelled</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sjlabelled/man/as_label.html">as_label</a></span>(<span class="no">p_spc</span>, <span class="kw">keep.labels</span><span class="kw">=</span><span class="fl">TRUE</span>))</pre></body></html></div>
</div>
<div id="step-pat-status" class="section level3">
<h3 class="hasAnchor">
<a href="#step-pat-status" class="anchor"></a>Step 6 - Determine patient status at end of FU</h3>
</div>
<div id="step-calc-futime" class="section level3">
<h3 class="hasAnchor">
<a href="#step-calc-futime" class="anchor"></a>Step 7 - Calculate FU time</h3>
</div>
<div id="step-sir-byfutime" class="section level3">
<h3 class="hasAnchor">
<a href="#step-sir-byfutime" class="anchor"></a>Step 8 - Calculate SIR</h3>
</div>
<div id="step-summarize-sir" class="section level3">
<h3 class="hasAnchor">
<a href="#step-summarize-sir" class="anchor"></a>Step 9 - Summarize SIR results</h3>
</div>
</div>
<div id="zfkd-melanoma" class="section level2">
<h2 class="hasAnchor">
<a href="#zfkd-melanoma" class="anchor"></a>ZfKD melanoma</h2>
<div id="step-1---long-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1---long-dataset" class="anchor"></a>Step 1 - Long dataset</h3>
</div>
<div id="step-2---filter-long-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#step-2---filter-long-dataset" class="anchor"></a>Step 2 - Filter long dataset</h3>
</div>
<div id="step-3---renumber-time_id" class="section level3">
<h3 class="hasAnchor">
<a href="#step-3---renumber-time_id" class="anchor"></a>Step 3 - Renumber <code>time_id</code>
</h3>
</div>
<div id="step-4---reshape-to-wide-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#step-4---reshape-to-wide-dataset" class="anchor"></a>Step 4 - Reshape to wide dataset</h3>
</div>
<div id="step-5---determine-patient-status-at-end-of-fu" class="section level3">
<h3 class="hasAnchor">
<a href="#step-5---determine-patient-status-at-end-of-fu" class="anchor"></a>Step 5 - Determine patient status at end of FU</h3>
</div>
<div id="step-6---calculate-fu-time" class="section level3">
<h3 class="hasAnchor">
<a href="#step-6---calculate-fu-time" class="anchor"></a>Step 6 - Calculate FU time</h3>
</div>
</div>
<div id="built-with" class="section level2">
<h2 class="hasAnchor">
<a href="#built-with" class="anchor"></a>Built with</h2>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()
<span class="co">#&gt; R version 4.0.2 (2020-06-22)</span>
<span class="co">#&gt; Platform: x86_64-apple-darwin17.0 (64-bit)</span>
<span class="co">#&gt; Running under: macOS Catalina 10.15.6</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib</span>
<span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] msSPChelpR_0.8.4.9000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] rprojroot_1.3-2   digest_0.6.25     crayon_1.3.4      assertthat_0.2.1 </span>
<span class="co">#&gt;  [5] MASS_7.3-51.6     R6_2.4.1          backports_1.1.8   magrittr_1.5     </span>
<span class="co">#&gt;  [9] evaluate_0.14     stringi_1.4.6     rlang_0.4.7       data.table_1.13.1</span>
<span class="co">#&gt; [13] fs_1.5.0          rmarkdown_2.3     pkgdown_1.5.1     desc_1.2.0       </span>
<span class="co">#&gt; [17] tools_4.0.2       stringr_1.4.0     yaml_2.2.1        xfun_0.16        </span>
<span class="co">#&gt; [21] compiler_4.0.2    memoise_1.1.0     htmltools_0.5.0   knitr_1.29</span></pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Marian Eberl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
